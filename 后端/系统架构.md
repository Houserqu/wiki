# 系统架构

## 架构模式

[系统设计入门](https://github.com/donnemartin/system-design-primer/blob/master/README-zh-Hans.md)

### 微服务

## 主要模块

### 负载均衡

#### DNS

优点：

- 使用简单：负载均衡工作，交给DNS服务器处理，省掉了负载均衡服务器维护的麻烦
- 提高性能：可以支持基于地址的域名解析，解析成距离用户最近的服务器地址，可以加快访问速度，改善性能；

缺点：

- 可用性差：DNS解析是多级解析，新增/修改DNS后，解析时间较长；解析过程中，用户访问网站将失败；
- 扩展性低：DNS负载均衡的控制权在域名商那里，无法对其做更多的改善和扩展；
- 维护性差：也不能反映服务器的当前运行状态；支持的算法少；不能区分服务器的差异（不能根据系统与服务的状态来判断负载）

#### 反向代理

![picture 20](http://qiniu.houserqu.com/c4eee172d49f9efaf78f587713075fcb2f29a48354d1ef65445aa0894c58b015.png)  

所有请求先经过 Nginx （网关），在代理到不同的机器上，存在网关服务器扛不住而崩溃的情况

#### 数据链路返回

![picture 21](http://qiniu.houserqu.com/b522aa377d1d5e2579a90e87fff355d5194b20e7675586b2db20852222d4deec.png)  

这种方式，通过给应用服务器设置虚拟IP，然后通过修改mac地址的方式，将请求分发出去，而应用服务器 收到请求后，可以直接响应给客户端。

好处是网关服务器只需要接受请求，不需要他来响应，由应用服务器自己去响应，降低网关压力

#### 混合模式

![picture 22](http://qiniu.houserqu.com/0b7c9faf764b3dc06547803ee246fb48b0576434d883e1f585fc29ac328bac01.png)  

![picture 23](http://qiniu.houserqu.com/ef8a6760a341b9dd9bbb7783eaa9699cd23c1040b0ed781f52cdb51fc7a425c6.png)  

#### NGINX

##### 负载均衡算法

###### 轮询

将所有请求，依次分发到每台服务器上，适合服务器硬件同相同的场景。
优点：服务器请求数目相同；
缺点：服务器压力不一样，不适合服务器配置不同的情况；

###### 随机

请求随机分配到各个服务器。
优点：使用简单；
缺点：不适合机器配置不同的场景；

###### 最少链接

将请求分配到连接数最少的服务器（目前处理请求最少的服务器）。
优点：根据服务器当前的请求处理情况，动态分配；
缺点：算法实现相对复杂，需要监控服务器请求连接数；

###### Hash（源地址散列）

根据IP地址进行Hash计算，得到IP地址。
优点：将来自同一IP地址的请求，同一会话期内，转发到相同的服务器；实现会话粘滞。
缺点：目标服务器宕机后，会话会丢失；

###### 加权

在轮询，随机，最少链接，Hash’等算法的基础上，通过加权的方式，进行负载服务器分配。
优点：根据权重，调节转发服务器的请求数目；
缺点：使用相对复杂