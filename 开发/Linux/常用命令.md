# 常用命令

> 参考：[Linux命令大全](https://man.linuxde.net/)

> 推荐阅读《命令行艺术》

[jlevy/the-art-of-command-line](https://github.com/jlevy/the-art-of-command-line/blob/master/README-zh.md)

## 命令行使用

### 快捷键

- ctrl-u 删除光标前所有内容
- ctrl-k 删除光标后所有内容
- ctrl-w 删除你键入的最后一个单词
- alt-b , alt-f 可以以单词为单位移动光标（mac 不适用）
- ctrl-a 将光标移至行首
- ctrl-e 可以将光标移至行尾
- ctrl-l 可以清屏
- ctrl-r 搜索命令行历史记录，重复按查找下一个
- ctrl-x ctrl-e 打开一个编辑器来编辑当前输入的命令（按顺序按两快捷键）

## 基本

```bash
ls -al > myfile     # 默认输出内容到屏幕，通过 > 符号可以输出到文件中

ls -al; pwd;        # 执行多条命令（互相不依赖执行结果）
mkdir images && cd images # 执行多条命令（后面命令依赖前面命令到成功）,也可以使用 || 组合

echo 'some' | tail # 管道：命令之间用竖线分割，上一个命令的结果会作为下一个命令的输入
cd -               # 回到之前的路径
alias ll='ls -latr'# 创建了一个新的命令别名 ll
```

## cp

`文件操作

```bash
cp file newfile     # 复制文件
cp –r test/ newtest # 复制目录
```

## 进程相关

[更多参考](https://www.runoob.com/w3cnote/linux-check-port-usage.html)

```bash
lsof -i          # 查看所有网络连接信息
lsof -i 8080     # 查看占用 8080 端口进程
kill {pid}       # 杀死进程 
netstat -ntlp    # 查看所有tcp端口占用
lsof -i tcp:8080 # mac 查看端口占用
netstat -tunlp | grep [端口号]
```

### grep

[文本搜索工具](https://www.runoob.com/linux/linux-comm-grep.html)

```bash
grep text access.log | jsonlog # 以json的格式输出匹配的文本，需要装json工具

# 从根目录开始查找所有扩展名为 .log 的文本文件，并找出包含 "ERROR" 的行：
find / -type f -name "*.log" | xargs grep "ERROR"

grep –e "正则表达式" 文件名 # 从文件内容查找与正则表达式匹配的行：
grep -E '123|abc' filename # 多个关键字-或
grep pattern1 files | grep pattern2 # 多个关键字-与
grep –i "被查找的字符串" 文件名  # 查找时不区分大小写：
grep -w pattern files # 单词匹配
grep -C number pattern files # 匹配的上下文分别显示[number]行，
grep -rn --exclude-dir="node_modules"  "xxx"  ./ # 在指定目录搜索并排除目录
```

## scp

服务器间传输文件

```bash
# 从服务器下载文件
scp username@remotehost.com:/path/to/foobar.txt /some/local/directory
# 本地文件上传到服务器
scp /some/local/directory/foobar.txt username@remotehost.com:/destination/path/
```

## curl

发送 http 请求 [更多参考](https://www.ruanyifeng.com/blog/2019/09/curl-reference.html)

```bash
# post 请求 (需要设置 header)
curl -H 'Content-Type: application/json' -d '{"type": "BUSINESS"}' -X POST http://localhost:8000/config/configs

# 下载文件到指定位置并显示进度
curl http://man.linuxde.net/test.iso -o filename.iso --progress

# 设置 cookie
curl http://localhost:8000 --cookie "user=root;pass=123456"

# 只打印响应到头部信息
curl -I http://localhost:8000
```

## less

分页查看文本，适合查看大文件或内容

```bash
less access.log  # 分页查看文件
ps -ef | less    # 分页查看进程

# 指令：
# /字符串：向下搜索“字符串”的功能
# ?字符串：向上搜索“字符串”的功能
# n：重复前一个搜索（与 / 或 ? 有关）
# N：反向重复前一个搜索（与 / 或 ? 有关）
# b  向后翻一页
# d  向后翻半页
# h  显示帮助界面
# Q  退出less 命令
# u  向前滚动半页
# y  向前滚动一行
# 空格键 滚动一页
# 回车键 滚动一行
```

## find

在指定目录下根据条件查找文件

```bash
find . -name test.txt 
find . -name *.log
find / -size +500M      # 查找大于 500M 的文件
```

## df

查看磁盘占用情况

```bash
df [-ahikHTm] [目录或文件名]
df -h # 以易读的方式展示磁盘情况
```

## du

查看文件和目录的使用的磁盘空间

```bash
du [-abcDhHklmsSx][-L <符号连接>][-X <文件>][--block-size][--exclude=<目录或文件>]
[--max-depth=<目录层数>][--help][--version][目录或文件]

du         # 列出当前目录下所有目录的大小
du -a      # 文件的大小也列出来
du -sh ./* # 列出当前目录下一级子目录的大小
du -lh --max-depth=1 # 查看当前目录下一级子文件和子目录占用的磁盘容量
```

## tar

打包压缩工具

```bash
tar -czvf demo.tar.gz demo # 打包并压缩 demo 目录或者 demo 文件为 demo.tar.gz 文件
tar -czvf --exclude '.DS_Store' demo.tar.gz  demo # 排除 .DS_Store 文件
tar -tzvf demo.tar.gz      # 列出压缩文件内容
tar -xzvf demo.tar.gz      # 解压 demo.tar.gz 文件
tar -xzvf demo.tar.gz -C /home  # 解压 demo.tar.gz 文件到 /home 目录下
```

## **chmod**

文件权限

```bash
# 8 进制模式，依次代表：属主、组、其他用户
chmod 666 index.js

# 符号模式
# u:代表用户 g:代表组 o:代表其他 a:代表上述所有
# + 增加，- 移除，= 设置为
[ugoa…][[+-=][rwxXstugo…]
chmod g+r index.js        # 给文件所属属组用户赋予读取权限

# 改变属主
chown guest index.js      # 属主变成guest
```

## scp

（secure copy）linux 之间复制文件

```bash
# 本地复制到远程
scp local_file remote_username@remote_ip:remote_folder # 复制文件到指定目录
scp local_file remote_username@remote_ip:remote_file   # 复制文件为指定文件
scp -r local_folder remote_username@remote_ip:remote_folder # 复制目录到指定目录

# 远程复制到本地（更换参数位置即可）
scp remote_username@remote_ip:remote_file local_folder
scp remote_username@remote_ip:remote_folder local_folder
```

## which

常用于查找可直接执行的命令，只在$PATH路径中搜索，查找范围最小。

```bash
which nginx    # 查找第一个 nginx 命令的文件位置
which -a nginx # -a 查找所有的
```

## 其他

```bash
# 统计目录下所有文件行数
find . -type f | xargs cat | wc -l
```