# 架构模式 Architectural Patterns

## 领域驱动设计 Domain-Driven Design

> [An Introduction to Domain-Driven Design - DDD w/ TypeScript](https://khalilstemmler.com/articles/domain-driven-design-intro/)
> [领域驱动设计在互联网业务开发中的实践](https://tech.meituan.com/2017/12/22/ddd-in-practice.html)

> - 贫血模型：把数据和行为分离到不同的对象之中，数据对象即DTO或者ViewObject只表示数据，不包括业务逻辑，而将业务逻辑转移到 Service中。
> - 充血模型：将数据和行为都合并到一起，采用标准的OO模式

### 领域驱动设计中的重要组成部分

![DDD Diagram](http://qiniu.houserqu.com/ddd-diagram-20210618191751507-20210618191843465.svg)

- 实体（Entity）：包含唯一标识ID的对象。

- 值对象（Value-Object）：没有标识ID的数据对象，例如实体的属性。
- 集合（Aggregate）：包含一个根实体的弱干实体的集合，集合内所有实体的操作必须依赖根实体，集合尽可能的小。
- 服务（Service）：对实体进行无状态、无副作用的操作方法。
- 存储库（Repository）：处理持久存储与对象之间的映射。
- 工厂（Factory）：将复杂领域对象的创建/重建过程独立出来。
- 领域事件（Domain-Events）：通过事件或者外部消息队列解耦多个领域之间的互相依赖。

#### 使用领域驱动设计的步骤

1. 收集和理解该领域的知识，统一概念和术语。
2. 利用**模型元素**将系统的各个部分进行定义。可以借助 UML 图进行表达。
3. 结合**聚合模式**，划分各个实体的边界。
4. 将实体归纳到不同的模块中。
5. 结合工厂模式、Repository 模式和分层原则，进行开发。

![领域驱动设计](http://qiniu.houserqu.com/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1-20210618093811257.jpeg)

#### 一些要点

##### 分层

- 领域相关的代码都应该放在领域层中，应用层不应该包含领域知识。
- 领域层不应该再进行过多的分层，即使分层，各层文件也应该放在一个模块目录中便于管理。

##### 模式

- **聚合模式**是确定一个**根实体**，将与根实体紧密关联的实体聚合在一起，得到一个聚合对象，对关联实体的操作，都必须通过聚合对象提供的方法。
- **工厂模式**是为了将聚合对象的复杂创建过程独立出来，并处理聚合对象中各个实体的固定规则。
- Repository （存储库）是处理数据存储结构（DB）与对象的映射（类似于 ORM 库中的 Model）。

## 微服务架构

> [一篇文章快速理解微服务架构](http://dockone.io/article/3687)

### 可用性与一致性

#### CAP 理论

在一个分布式计算系统中，只能同时满足下列的两点:

- **一致性** ─ 每次访问都能获得最新数据但可能会收到错误响应
- **可用性** ─ 每次访问都能收到非错响应，但不保证获取到最新数据
- **分区容错性** ─ 在任意分区网络故障的情况下系统仍能继续运行

**网络并不可靠，所以你应要支持分区容错性，并需要在软件可用性和一致性间做出取舍。**

#### 一致性模式

同一份数据有多份副本，怎样同步才能让客户端有一致的数据。

[通俗易懂 强一致性、弱一致性、最终一致性、读写一致性、单调读、因果一致性 的区别与联系](https://zhuanlan.zhihu.com/p/67949045)

##  书籍

《架构即未来》

《微服务架构设计》



