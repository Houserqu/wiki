# 缓存

## 概念

### 缓存类型

| 类型           | 说明                                                         |
| -------------- | ------------------------------------------------------------ |
| 客户端缓存     | 操作系统或者浏览器等客户端本地进行缓存                       |
| CDN 缓存       | 在离用户最近的网络节点上进行缓存                             |
| Web 服务器缓存 | Nginx 等服务可以将静态或动态内容进行缓存，不每次去请求应用服务器 |
| 数据库缓存     | 数据库的默认配置中通常包含缓存级别                           |
| 应用缓存       | 应用程序使用 Memcached、Redis 等程序将数据缓存在内存中，而不是每次从磁盘读取 |

### 何时更新缓存

#### 缓存模式（策略）

流程：

1. 在缓存中查找记录，如果所需数据不在缓存中
2. 从数据库中加载所需内容
3. 将查找到的结果存储到缓存中
4. 返回所需内容

缺点：

1. 请求的数据如果不在缓存中就需要经过三个步骤来获取数据，会存在延迟
2. 如果DB数据更新了，缓存会过时，需要设置 ttl 或者用**直写模式**来解决

#### 直写模式

流程：

1. 应用向缓存中添加/更新数据
2. 缓存同步地写入数据存储
3. 返回所需内容

缺点：

1. 可能会缓存大量不会被读取到的数据，可以用 ttl 一定程度上解决
2. 新的节点不会缓存，直到数据库更新为止

#### 回写模式

流程：

1. 在缓存中增加或者更新条目
2. 异步写入 DB

## Redis

### 常用命令

```jsx
> redis-cli -h {ip} -a {password} // 登录
```

### 基础概念

[Redis 简介](https://www.bookstack.cn/read/redis-tutorial/0.md)

#### 数据库

redis 默认有16个数据库，不能自定义名称，而且共用同一个密码，数据库之间不是完全隔离的，FLUSHALL可以清空所有数据库。

所以如果有多个应用需要使用 redis，通过不同实例来实现，一个实例一个配置文件，可以配置端口、名称、密码

[参考](https://www.cnops.xyz/archives/996)

#### 数据类型

![picture 28](../../images/1fe077fc9f0302e87ccc87456a1e60d33a47100e746e15371ac5bacfca425ddb.png)  

#### 发布订阅

#### JSON

redis 默认只能存储文本数据，但是可以通过 RedisJSON 模块实现直接存储/读取 json 数据
[https://hub.docker.com/r/redislabs/rejson/](https://hub.docker.com/r/redislabs/rejson/)